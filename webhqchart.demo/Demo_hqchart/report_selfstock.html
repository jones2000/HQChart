<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">  
<head>  
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />  
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<title>自选股</title>  
    <link rel="stylesheet" href="../jscommon/umychart.resource/css/tools.css" />
    <link rel="stylesheet" href="../jscommon/umychart.resource/font/iconfont.css" />
</head>  
<body>
    <div id="report" style="width: 900px;height:400px">
    </div>

    <script src="../jscommon/umychart.resource/js/jquery.min.js"></script>
    <script src="../jscommon/umychart.resource/js/webfont.js"></script>
    <script src="../jscommon/umychart.network.js"></script>
    <script src="../jscommon/umychart.js"></script>             <!-- K线图形 -->
    <script src="../jscommon/umychart.report.js"></script>    <!-- 麦语言解析执行器 -->
    <script src="../jscommon/umychart.style.js"></script>       <!-- 白色风格和黑色风格配置信息 -->
    <script src="../jscommon/umychart.complier.js"></script>    <!-- 麦语言解析执行器 -->
    <script src="../jscommon/umychart.index.data.js"></script>  <!-- 基础指标库 -->
    <script src="../jscommon/umychart.popMenu.js"></script>
    <script src="../jscommon/umychart.PopMinuteChart.js"></script>
    <script src="../jscommon/umychart.PopKLineChart.js"></script>
    <script src="../jscommon/umychart.DialogTooltip.js"></script>
    <script src="../jscommon/umychart.version.js"></script>


    <script src="./src/EnvironmentVariable.js"></script>
    <script src="./src/HQData.js"></script>  <!-- 数据 -->

    <script>

        //JSConsole.Chart.Log=() =>{}
        //JSConsole.Complier.Log=()=>{}

        MARKET_SUFFIX_NAME.GetMarketStatus = function (symbol)  { return 2; }

        //简单的把K线控件封装下
        function ReportChart(divDeal)
        {
            this.DivDeal=divDeal;
            this.Chart=JSReportChart.Init(divDeal);     //把报价列表绑定到一个Div上
            this.HQData=new HQData();                   //数据接口

            //配置信息
            this.Option= 
            {
                Type:'报价列表',   //创建图形类型
                
                Symbol:"自选股1",  //板块代码
                Name:"自选股1",

                IsAutoUpdate:true,           //是自动更新数据
                AutoUpdateFrequency:10000,   //数据更新频率
                
                //显示列
                Column:
                [
                    {Type:REPORT_COLUMN_ID.INDEX_ID },
                    {Type:REPORT_COLUMN_ID.SYMBOL_ID,  SortType:[0], EnableDragWidth:true, ChartTooltip:{ Enable:true, Type:20 } },
                    {Type:REPORT_COLUMN_ID.NAME_ID ,EnableDragWidth:true, ChartTooltip:{ Enable:true, Type:21 }},
                    {Type:REPORT_COLUMN_ID.INCREASE_ID, ID:REPORT_COLUMN_ID.INCREASE_ID },
                    {Type:REPORT_COLUMN_ID.PRICE_ID, ID:REPORT_COLUMN_ID.PRICE_ID },
                    {Type:REPORT_COLUMN_ID.UPDOWN_ID,  },
                    {Type:REPORT_COLUMN_ID.BUY_PRICE_ID, ID:REPORT_COLUMN_ID.BUY_PRICE_ID},
                    {Type:REPORT_COLUMN_ID.SELL_PRICE_ID, ID:REPORT_COLUMN_ID.SELL_PRICE_ID},
                    {Type:REPORT_COLUMN_ID.VOL_ID },
                    {Type:REPORT_COLUMN_ID.OPEN_ID},
                    {Type:REPORT_COLUMN_ID.HIGH_ID },
                    {Type:REPORT_COLUMN_ID.LOW_ID},
                    {Type:REPORT_COLUMN_ID.AMOUNT_ID},
                    {Type:REPORT_COLUMN_ID.YCLOSE_ID, },
                    {Type:REPORT_COLUMN_ID.AMPLITUDE_ID },
                   
                    {Type:REPORT_COLUMN_ID.DATE_ID, Title:"更新日期", TitleAlign:"center"},
                    {Type:REPORT_COLUMN_ID.TIME_ID,  Title:"更新时间", TitleAlign:"center", ValueType:1,  MaxText:"99:99:99"},
                ],
                
                FixedColumn:3,      //固定列

                //SortInfo:{ Field:5, Sort: 1 },   //默认排序信息

                //IsShowHeader:false,

                //KeyDown:false,
                //Wheel:false,

                //BorderLine:0,
                //SelectedModel:1,

                EnablePopMenuV2:true,
                EnableDragRow:true,
                EnableDragHeader:true,

                SplashTitle:{ StockList:"xxxxxxx"},
               
                Border: //边框
                {
                    Left:20,        //左边间距
                    Right:20,       //右边间距
                    Bottom:20,      //底部间距
                    Top:20          //顶部间距
                },

                
                MinuteChartTooltip:
                { 
                    Enable:true,
                    Option:{ EnableResize:false }
                },

                
                KLineChartTooltip:
                { 
                    Enable:true,
                    Option:{ EnableResize:false }
                },
                
                
                Tab:
                [
                    { Title:"自选股1", ID:"自选股1", CommandID:JSCHART_MENU_ID.CMD_REPORT_CHANGE_BLOCK_ID},
                    { Title:"自选股2", ID:"自选股2", CommandID:JSCHART_MENU_ID.CMD_REPORT_CHANGE_BLOCK_ID},
                    { Title:"自选股3", ID:"自选股3", CommandID:JSCHART_MENU_ID.CMD_REPORT_CHANGE_BLOCK_ID},
                ],
                
                TabSelected:0,  //默认选中tab页  
            };
                 
            this.Create=function()  //创建图形
            {
                $(window).resize(()=> { this.OnSize(); });    //绑定窗口大小变化事件

                this.OnSize();  //全屏

                this.InitalSelfBlock();

                //黑色风格
                var blackStyle=HQChartStyle.GetStyleConfig(STYLE_TYPE_ID.BLACK_ID); //读取黑色风格配置
                JSReportChart.SetStyle(blackStyle);
                this.DivDeal.style.backgroundColor=blackStyle.BGColor; //设置最外面的div背景
        
                this.Option.NetworkFilter=(data, callback)=>{ this.NetworkFilter(data, callback); };

                this.Option.EventCallback= 
                [ 
                    {   //根据大小单显示成交量颜色
                        event:JSCHART_EVENT_ID.ON_DRAW_DEAL_VOL_COLOR, 
                        callback:(event, data, obj)=>{ this.GetVolColor(event, data, obj); }  
                    },

                    {   //单击
                        event:JSCHART_EVENT_ID.ON_CLICK_REPORT_ROW, 
                        callback:(event, data, obj)=>{ this.OnClickRow(event, data, obj); }  
                    },
                    {   //右键单击
                        event:JSCHART_EVENT_ID.ON_RCLICK_REPORT_ROW, 
                        callback:(event, data, obj)=>{ this.OnRClickRow(event, data, obj); }  
                    },

                    {   //双击
                        event:JSCHART_EVENT_ID.ON_DBCLICK_REPORT_ROW, 
                        callback:(event, data, obj)=>{ this.OnDBClickRow(event, data, obj); }  
                        
                    },

                    {   //单击表头
                        event:JSCHART_EVENT_ID.ON_CLICK_REPORT_HEADER, 
                        callback:(event, data, obj)=>{ this.OnClickHeader(event, data, obj); }  
                    },
                    {   //右键单击表头
                        event:JSCHART_EVENT_ID.ON_RCLICK_REPORT_HEADER, 
                        callback:(event, data, obj)=>{ this.OnRClickHeader(event, data, obj); }  
                    },

                    {
                        event:JSCHART_EVENT_ID.ON_DRAW_CUSTOM_TEXT, 
                        callback:(event, data, obj)=>{ this.OnGetCustomText(event, data, obj); }  
                    },

                    //点击tab切换板块
                    {
                        event:JSCHART_EVENT_ID.ON_CLICK_REPORT_TAB, 
                        callback:(event, data, obj)=>{ this.OnClickTab(event, data, obj); } 
                    },

                    {
                        event:JSCHART_EVENT_ID.ON_REPORT_MOUSE_MOVE,
                        callback:(event, data, obj)=>{ this.OnMouseMove(event, data, obj); }
                    },

                    //右键菜单
                    {
                        event:JSCHART_EVENT_ID.ON_CREATE_RIGHT_MENU, 
                        callback:(event, data, obj)=>{ this.OnCreateRightMenu(event, data, obj); }

                    },
                    //菜单执行
                    {
                        event:JSCHART_EVENT_ID.ON_MENU_COMMAND,
                        callback:(event, data, obj)=>{ this.OnMenuCommand(event, data, obj); }
                    },
                    {
                        event:JSCHART_EVENT_ID.ON_REPORT_DRAG_ROW,
                        callback:(event, data, obj)=>{ this.OnReportDragRow(event, data, obj); }
                    }
                ];

                this.Chart.SetOption(this.Option);  //设置配置
            }

            this.InitalSelfBlock=function()
            {
                var SELF_STOCK_LIST_1=["600000.sh", "000001.sz", "600999.sh","688330.sh","688337.sh","688395.sh","688597.sh","688611.sh",];

                var SELF_STOCK_LIST_2=
                [
                    "000400.sz","000682.sz","002058.sz","002090.sz","002121.sz","002169.sz","002184.sz","002322.sz","002334.sz","002339.sz",
                    "002527.sz","002546.sz","002767.sz","002979.sz","300018.sz","300040.sz","300048.sz","300124.sz","300208.sz","300286.sz",
                    "300360.sz","300407.sz","300427.sz","300466.sz","300484.sz","300490.sz","300514.sz","300745.sz","300880.sz",
                    "300882.sz","301179.sz","600268.sh","600406.sh","600525.sh","600590.sh","601126.sh","601222.sh","601567.sh","603015.sh",
                    "603025.sh","603050.sh","603063.sh","603100.sh","603416.sh","603583.sh","603859.sh","605288.sh","688191.sh","688248.sh",
                    "688330.sh","688337.sh","688395.sh","688597.sh","688611.sh","688616.sh","688681.sh","688698.sh","688777.sh", "300356.sz",
                ];

                var SELF_STOCK_LIST_3=["688395.sh","688597.sh","688611.sh","688597.sh","300040.sz"];

                this.HQData.SetSelfBlock("自选股1", SELF_STOCK_LIST_1);
                this.HQData.SetSelfBlock("自选股2", SELF_STOCK_LIST_2);
                this.HQData.SetSelfBlock("自选股3", SELF_STOCK_LIST_3);   
            }

            this.OnSize=function()  //自适应大小调整
            {
                var height= $(window).height();
                var width = $(window).width();
                this.DivDeal.style.top='0px';
                this.DivDeal.style.left='0px';
                this.DivDeal.style.width=width+'px';
                this.DivDeal.style.height=height+'px';
                if (this.Chart) this.Chart.OnSize();
            }

            this.NetworkFilter=function(data, callback)
            {
                console.log('[ReportChart::NetworkFilter] data', data);
                var option={ };
                switch(data.Name)
                { 
                    default:
                        this.HQData.NetworkFilter(data, callback, option);  
                        break;
                }
            }

            this.OnClickRow=function(event, data, obj)
            {
                console.log('[ReportChart::OnClickRow] event, data', event , data);
            }

            this.OnRClickRow=function(event, data, obj)
            {
                console.log('[ReportChart::OnRClickRow] event, data', event , data);
            }

            this.OnDBClickRow=function(event, data, obj)
            {
                console.log('[ReportChart::OnDBClickRow] event, data', event , data);
            }

            this.OnClickHeader=function(event, data, obj)
            {
                console.log('[ReportChart::OnClickHeader] event, data', event , data);
            }

            this.OnRClickHeader=function(event, data, obj)
            {
                console.log('[ReportChart::OnRClickHeader] event, data', event , data);
            }

            //根据大小单显示成交量颜色
            this.GetVolColor=function(event, data, obj) 
            {
                if (data.Data.Vol>50000) data.TextColor='rgb(128,0,128)';
            }

            this.OnGetCustomText=function(event, data, obj) 
            {
                //console.log('[ReportChart::OnGetCustomText] event, data', event , data);
                if (data.Column.ID==10)
                {
                    data.Out.TextColor="rgb(139,101,8)";
                    if (data.Value>20000101) 
                    {
                        data.Out.TextColor='rgb(153,50,204)';
                        data.Out.TextAlign='left';
                        data.Out.BGColor="rgb(255,211 ,155)";
                    }
                    data.Out.Text=`${data.Value}`;
                }

                //data.Out.Text=`${data.ColIndex}-${data.RowIndex}`;
                //data.Out.TextColor=out.Color;
                //data.Out.TextAlign='center';
            }

            this.OnClickTab=function(event, data, obj)
            {
                console.log('[ReportChart::OnClickTab] event, data', event , data);
                var tabItem=data.Data.Tab;
                var symbol=tabItem.ID;  //板块ID;
            }

            this.OnMouseMove=function(event, data, obj)
            {
                if (data && data.Cell)
                {
                    console.log(`[ReportChart::OnMouseMove] ${data.Cell.Column.Title} ${data.Cell.Stock.OriginalSymbol}`);
                }
            }

            this.OnCreateRightMenu=function(event, data, obj)
            {
                console.log(`[ReportChart::OnCreateRightMenu] ${data}`);

                var selfSymbol=obj.Symbol;

                var TEST_SYMBOL_LIST=["600638.sh", "600655.sh", "600671.sh", "600758.sh"];

                var aryMenu=[];
                for(var i=0;i<TEST_SYMBOL_LIST.length;++i)
                {
                    var item=TEST_SYMBOL_LIST[i];
                    var menuItem={ Name:`添加[${item}]`, Data:{ ID:"__Test_Add__", Args:[item,selfSymbol] } };
                    aryMenu.push(menuItem);
                }
                
                if (data.Data.Type==2)   //行
                {
                    var symbol=data.Data.Row.Symbol;
                    
                    aryMenu.push({ Name:JSPopMenu.SEPARATOR_LINE_NAME });
                    var menuItem={ Name:`删除[${symbol}]`, Data:{ ID:"__Test_Delete__", Args:[symbol,selfSymbol] } };
                    aryMenu.push(menuItem);
                }

                if (aryMenu.length>0)
                    data.MenuData.Menu=aryMenu;
            }

            this.OnMenuCommand=function(event, data, obj)
            {
                if (data.CommandID=="__Test_Add__")
                {
                    var symbol=data.Args[0];
                    var selfSymbol=data.Args[1];

                    if (this.MapSelf.has(selfSymbol))
                    {
                        var item=this.MapSelf.get(selfSymbol);
                        if (!item.SetSymbol.has(symbol))
                        {
                            item.Data.push(symbol);
                            item.SetSymbol.add(symbol);
                        }
                    }

                    if (obj.Symbol==selfSymbol) obj.AddSymbol([symbol]);
                    data.PreventDefault=true;
                }
                else if (data.CommandID=="__Test_Delete__")
                {
                    var symbol=data.Args[0];
                    var selfSymbol=data.Args[1];

                    if (this.MapSelf.has(selfSymbol))
                    {
                        var item=this.MapSelf.get(selfSymbol);
                        if (item.SetSymbol.has(symbol))
                        {
                            item.Data=item.Data.filter((item)=>{return item!=symbol});
                            item.SetSymbol.delete(symbol);
                        }
                    }

                    if (obj.Symbol==selfSymbol) obj.DeleteSymbol([symbol]);
                    data.PreventDefault=true;
                }
            }

            this.OnReportDragRow=function(event, data, obj)
            {
                console.log('[ReportChart::OnReportDragRow] data=', data);
            }
        }

        var g_reportCtrl;
        
        $(function () 
        {
            EnvironmentVariable.Load();
            
            var wsClient=new HQChartWSClient();
            wsClient.Create();
            
            var reportCtrl=new ReportChart(document.getElementById('report'));
            reportCtrl.HQData.WSClient=wsClient;

            reportCtrl.Create();
            g_reportCtrl=reportCtrl;
        })

    </script>  
</body>  
</html>


<style>

.report
{
    width: 100%;
    height:100%;
    position: relative;
}
       
</style>
